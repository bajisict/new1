import{r as u}from"./index.BVOCwoKb.js";var N={exports:{}},p={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var f;function k(){if(f)return p;f=1;var m=Symbol.for("react.transitional.element"),c=Symbol.for("react.fragment");function a(l,s,n){var i=null;if(n!==void 0&&(i=""+n),s.key!==void 0&&(i=""+s.key),"key"in s){n={};for(var o in s)o!=="key"&&(n[o]=s[o])}else n=s;return s=n.ref,{$$typeof:m,type:l,key:i,ref:s!==void 0?s:null,props:n}}return p.Fragment=c,p.jsx=a,p.jsxs=a,p}var y;function E(){return y||(y=1,N.exports=k()),N.exports}var e=E();const S=({isOpen:m,onClose:c})=>{const[a,l]=u.useState([]),[s,n]=u.useState(!1);u.useEffect(()=>{const t=localStorage.getItem("shopping-cart");t&&l(JSON.parse(t)),localStorage.getItem("shopping-cart")},[m]);const i=t=>{localStorage.setItem("shopping-cart",JSON.stringify(t)),l(t)},o=(t,r)=>{if(r<=0){h(t);return}const d=a.map(x=>x.id===t?{...x,quantity:r}:x);i(d),j(d)},h=t=>{const r=a.filter(d=>d.id!==t);i(r),j(r)},b=()=>{i([]),j([])},g=a.reduce((t,r)=>t+r.price*r.quantity,0),C=a.reduce((t,r)=>t+r.quantity,0),v=t=>new Intl.NumberFormat("mn-MN").format(t)+"₮",w=async()=>{n(!0);try{if((await fetch("/api/orders",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({items:a,total:g,orderDate:new Date().toISOString()})})).ok)b(),c(),alert("Захиалга амжилттай илгээгдлээ!");else throw new Error("Захиалга илгээхэд алдаа гарлаа")}catch(t){console.error("Checkout error:",t),alert("Алдаа: "+t.message)}finally{n(!1)}},j=t=>{const r=t.reduce((x,I)=>x+I.quantity,0),d=document.getElementById("cartCount");d&&(d.textContent=r.toString())};return m?e.jsx("div",{className:"modal show d-block",tabIndex:"-1",style:{backgroundColor:"rgba(0,0,0,0.5)"},children:e.jsx("div",{className:"modal-dialog modal-lg modal-dialog-scrollable",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header bg-primary text-white",children:[e.jsxs("h5",{className:"modal-title",children:[e.jsx("i",{className:"bi bi-cart3 me-2"}),"Миний сагс (",C," бараа)"]}),e.jsx("button",{type:"button",className:"btn-close btn-close-white",onClick:c})]}),e.jsx("div",{className:"modal-body",children:a.length===0?e.jsxs("div",{className:"text-center py-5",children:[e.jsx("i",{className:"bi bi-cart-x display-1 text-muted"}),e.jsx("h4",{className:"mt-3 text-muted",children:"Сагс хоосон байна"}),e.jsx("p",{className:"text-muted",children:"Бараа нэмж эхлээрэй!"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"row g-3",children:a.map(t=>e.jsx("div",{className:"col-12",children:e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"row align-items-center",children:[e.jsx("div",{className:"col-3",children:e.jsx("img",{src:t.image,alt:t.name,className:"img-fluid rounded",style:{height:"80px",objectFit:"cover"}})}),e.jsxs("div",{className:"col-6",children:[e.jsx("h6",{className:"mb-1",children:t.name}),e.jsx("p",{className:"text-primary mb-0 fw-bold",children:v(t.price)})]}),e.jsxs("div",{className:"col-3",children:[e.jsxs("div",{className:"input-group input-group-sm mb-2",children:[e.jsx("button",{"data-product-id":t.id,"data-product-name":t.name,"data-product-price":t.price,"data-product-image":t.image,className:"btn btn-outline-secondary ",onClick:()=>o(t.id,t.quantity-1),children:e.jsx("i",{className:"bi bi-dash"})}),e.jsx("input",{type:"number",className:"form-control text-center",value:t.quantity,onChange:r=>o(t.id,parseInt(r.target.value)||1),min:"1"}),e.jsx("button",{className:"btn btn-outline-secondary",onClick:()=>o(t.id,t.quantity+1),children:e.jsx("i",{className:"bi bi-plus"})})]}),e.jsx("button",{className:"btn btn-outline-danger btn-sm w-100",onClick:()=>h(t.id),children:e.jsx("i",{className:"bi bi-trash"})})]})]})})})},t.id))}),e.jsx("hr",{}),e.jsx("div",{className:"bg-light p-3 rounded",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsx("h5",{className:"mb-0",children:"Нийт дүн:"}),e.jsx("h4",{className:"mb-0 text-primary",children:v(g)})]})})]})}),a.length>0&&e.jsxs("div",{className:"modal-footer",children:[e.jsxs("button",{type:"button",className:"btn btn-outline-secondary",onClick:b,children:[e.jsx("i",{className:"bi bi-trash me-1"}),"Бүгдийг устгах"]}),e.jsx("button",{type:"button",className:"btn btn-primary",onClick:w,disabled:s,children:s?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2"}),"Илгээж байна..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"bi bi-credit-card me-1"}),"Худалдан авах"]})})]})]})})}):null},q=()=>{const[m,c]=u.useState(!0),[a,l]=u.useState(0);return u.useEffect(()=>{const s=()=>{const n=localStorage.getItem("shopping-cart");if(n){const o=JSON.parse(n).reduce((h,b)=>h+b.quantity,0);l(o)}else l(0)};return s(),window.addEventListener("storage",s),window.addEventListener("cartUpdated",s),()=>{window.removeEventListener("storage",s),window.removeEventListener("cartUpdated",s)}},[]),e.jsxs(e.Fragment,{children:[e.jsxs("button",{className:"btn btn-primary position-relative",onClick:()=>c(!0),children:[e.jsx("i",{className:"bi bi-cart3 me-2"}),"Сагс",a>0&&e.jsx("span",{className:"position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger",children:a})]}),e.jsx(S,{isOpen:m,onClose:()=>c(!1)})]})};export{q as default};
